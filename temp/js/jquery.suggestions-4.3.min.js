/**
 * DaData.ru Suggestions jQuery plugin, version 4.3.3
 *
 * DaData.ru Suggestions jQuery plugin is freely distributable under the terms of MIT-style license
 * Built on DevBridge Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(c,d){var e=this,f={autoSelectFirst:!1,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,noCache:!1,onSearchStart:a.noop,onSearchComplete:a.noop,onSearchError:a.noop,containerClass:"suggestions-suggestions",tabDisabled:!1,currentRequest:null,triggerSelectOnValidInput:!1,triggerSelectOnSpace:!0,preventBadQueries:!1,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b},usePreloader:!0,hint:b.defaultHint,useDadata:!0,type:null,count:b.defaultCount};e.element=c,e.el=a(c),e.suggestions=[],e.badQueries=[],e.selectedIndex=-1,e.currentValue=e.element.value,e.intervalId=0,e.cachedResponse={},e.onChangeInterval=null,e.onChange=null,e.isLocal=!1,e.suggestionsContainer=null,e.$wrapper=null,e.$preloader=null,e.options=a.extend({},f,d),e.classes={hint:"suggestions-hint",selected:"suggestions-selected",suggestion:"suggestions-suggestion"},e.hint=null,e.hintValue="",e.selection=null,e.$viewport=a(window),e.triggeredSelectOnSpace=!1,e.triggeringSelectOnSpace=!1,e.skipOnFocus=!1,e.enrichService=j.default,e.dropdownDisabled=!1,e.expectedComponents=[],e.initialize(),e.setOptions(d)}var c=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)},compact:function(b){return a.grep(b,function(a){return!!a})}}}(),d={ESC:27,TAB:9,RETURN:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},e=["NAME","ADDRESS"],f=".suggestions",g="suggestions",h={url:"https://dadata.ru/api/v1/clean",timeout:1e3},i={},j={};j["default"]={enrichSuggestion:function(b){return a.Deferred().resolve(b)},enrichResponse:function(b){return a.Deferred().resolve(b)}},j.dadata=function(){function b(b){var c=this,d=a.trim(c.options.token),e={structure:[c.options.type],data:[[b]]};return c.currentRequest=a.ajax(h.url,{type:"POST",headers:{Authorization:"Token "+d},contentType:"application/json",dataType:"json",data:JSON.stringify(e),timeout:h.timeout}),c.currentRequest}var d={};d.gender=function(a){return{gender:"М"==a?"MALE":"Ж"==a?"FEMALE":"UNKNOWN"}},a.each(["region","area","city","settlement","street"],function(a,b){function c(a){if("city"===b||"settlement"===b||"street"===b)return!0;var c=/^(г|Респ|тер|у)/i;return c.test(a)}d[b]=function(a){var d,e,f={};if(a){var g=a.split(" ");d=c(a)?g.shift():g.pop(),e=g.join(" ")}else d=null,e=a;return f[b+"_type"]=d,f[b]=e,f}});var e={NAME:function(a){return c.compact([a.surname,a.name,a.patronymic]).join(" ")},ADDRESS:function(a){return c.compact([a.country,a.region,a.area,a.city,a.settlement,a.street,c.compact([a.house_type,a.house]).join(" "),c.compact([a.block_type,a.block]).join(" "),c.compact([a.flat_type,a.flat]).join(" ")]).join(", ")}};return{enrichSuggestion:function(c){var e=this,f=a.Deferred();return c.data&&"qc"in c.data?f.resolve(c):(e.showPreloader(),e.disableDropdown(),b.call(e,c.value).always(function(){e.hidePreloader(),e.enableDropdown(),e.currentRequest=null}).done(function(b){var e=b.data,g=e&&e[0]&&e[0][0];g&&0===g.qc&&(c.data||(c.data={}),delete g.source,a.each(g,function(b,e){if(!(b in c.data)){var f=d[b];f?a.extend(c.data,f(e)):c.data[b]=e}})),f.resolve(c)}).fail(function(){f.resolve(c)}),f)},enrichResponse:function(c,f){var g=this,h=c.suggestions||[],i=a.Deferred();return h.length?i.resolve(c):(b.call(g,f).always(function(){g.currentRequest=null}).done(function(b){var f,h=b.data;h=h&&h[0]&&h[0][0],h&&(delete h.source,f=e[g.options.type](h),f&&(a.each(d,function(b,c){b in h&&a.extend(h,c(h[b]))}),c.suggestions=[{value:f,data:h}])),i.resolve(c)}).fail(function(){i.resolve(c)}),i)}}}(),b.utils=c,b.formatResult=function(a,b){var d="(^|\\s+)("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"$1<strong>$2</strong>")},b.resetTokens=function(){i={}},b.defaultHint="Выберите вариант ниже или продолжите ввод",b.dadataConfig=h,b.defaultCount=10,a.Suggestions=b,b.prototype={initialize:function(){var b,c=this,d="."+c.classes.suggestion,e=c.classes.selected,g=c.options;c.element.setAttribute("autocomplete","off"),c.$wrapper=a('<div class="suggestions-wrapper"/>'),c.el.after(c.$wrapper),c.$preloader=a('<i class="suggestions-preloader"/>'),c.$wrapper.append(c.$preloader),c.killerFn=function(b){0===a(b.target).closest("."+c.options.containerClass).length&&(c.killSuggestions(),c.disableKillerFn())},b=a("<div/>").addClass(g.containerClass).css({position:"absolute",display:"none"}),c.$container=b,c.suggestionsContainer=b[0],c.$wrapper.append(b),"auto"!==g.width&&b.width(g.width),b.on("mousedown"+f,d,function(b){b.preventDefault(),c.cancelBlur=!0,c._delay(function(){delete c.cancelBlur}),a(b.target).closest(".ui-menu-item").length||c._delay(function(){a(document).one("mousedown",function(b){b.target===c.element||b.target===c.suggestionsContainer||a.contains(c.suggestionsContainer,b.target)||c.hide()})})}),b.on("mouseover"+f,d,function(){c.activate(a(this).data("index"))}),b.on("mouseout"+f,function(){c.dropdownDisabled||(c.selectedIndex=-1,b.children("."+e).removeClass(e))}),b.on("click"+f,d,function(){c.dropdownDisabled||c.select(a(this).data("index")),c.skipOnFocus=!0,c.el.focus()}),c.fixPosition(),c.fixPositionCapture=function(){c.visible&&c.fixPosition()},c.$viewport.on("resize"+f,c.fixPositionCapture),c.el.on("keydown"+f,function(a){c.onKeyPress(a)}),c.el.on("keyup"+f,function(a){c.onKeyUp(a)}),c.el.on("blur"+f,function(){c.onBlur()}),c.el.on("focus"+f,function(){c.onFocus()}),c.el.on("change"+f,function(a){c.onKeyUp(a)})},onFocus:function(){var a=this;a.skipOnFocus||(a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()),a.skipOnFocus=!1},onBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:(a.selectCurrentValue(),void a.hide())},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.isLocal=a.isArray(d.lookup),c.isLocal&&(d.lookup=c.verifySuggestionsFormat(d.lookup));var e={"max-height":d.maxHeight+"px","z-index":d.zIndex};"auto"!==d.width&&(e.width=d.width+"px"),c.$container.css(e),c.checkToken(),c.selectEnrichService(),c.selectExpectedComponents()},getAjaxParams:function(){var b,d=this,e=a.trim(d.options.token);return b={type:c.getDefaultType(),dataType:"json",contentType:c.getDefaultContentType()},e&&(b.headers={Authorization:"Token "+e}),b},checkToken:function(){var b,c=this,d=a.trim(c.options.token),e=i[d],f=function(){c.checkToken()};if(d)if(e&&a.isFunction(e.promise))switch(e.state()){case"resolved":c.enable();break;case"rejected":c.disable();break;default:e.always(f)}else b=c.options.serviceUrl,a.isFunction(b)&&(b=b.call(c.element)),i[d]=a.ajax(a.extend(c.getAjaxParams(),{url:b})).always(f)},selectEnrichService:function(){var b=this,c=b.options.type,d=a.trim(b.options.token);b.enrichService=b.options.useDadata&&c&&e.indexOf(c)>=0&&d?j.dadata:j.default},selectExpectedComponents:function(){var b=this,c=b.options.type,d=b.options.params;switch(c){case"NAME":b.expectedComponents=a.map(d&&d.parts||["surname","name","patronymic"],function(a){return a.toLowerCase()});break;case"ADDRESS":b.expectedComponents=["house"];break;default:b.expectedComponents=[]}},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.currentRequest&&a.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var a=this,b="none"==a.el.css("border-top-style")?0:parseFloat(a.el.css("border-top-width")),c="none"==a.el.css("border-left-style")?0:parseFloat(a.el.css("border-left-width")),d=a.el.offset(),e=a.el.innerHeight(),f=a.el.innerWidth(),g=a.$wrapper.offset(),h={top:d.top-g.top,left:d.left-g.left};a.$container.css({left:h.left+"px",top:h.top+b+e+"px",width:("auto"===a.options.width?a.el.outerWidth():a.options.width)+"px"}),a.$preloader.css({left:h.left+c+f-a.$preloader.width()-4+"px",top:h.top+Math.round((e-a.$preloader.height())/2)+"px"})},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyPress:function(a){var b,c=this;if(c.triggeredSelectOnSpace=!1,c.triggeringSelectOnSpace=!1,!c.disabled&&!c.visible&&a.which===d.DOWN&&c.currentValue)return void c.suggest();if(!c.disabled&&c.visible){switch(a.which){case d.ESC:c.el.val(c.currentValue),c.hide();break;case d.RIGHT:if(c.hint&&c.options.onHint&&c.isCursorAtEnd()){c.selectHint();break}return;case d.TAB:if(c.hint&&c.options.onHint)return void c.selectHint();if(-1===c.selectedIndex)return void c.hide();if(c.select(c.selectedIndex),c.options.tabDisabled===!1)return;break;case d.RETURN:if(b=c.selectCurrentValue(),-1===b)return void c.hide();break;case d.SPACE:return void(c.options.triggerSelectOnSpace&&c.isCursorAtEnd()&&(c.triggeringSelectOnSpace=!0,b=c.selectCurrentValue(!0),-1!==b&&(c.triggeredSelectOnSpace=!0)));case d.UP:c.moveUp();break;case d.DOWN:c.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b,c=this,d=c.options,e=c.el.val(),f=c.getQuery(e);return c.selection&&(c.selection=null,(d.onInvalidateSelection||a.noop).call(c.element)),clearInterval(c.onChangeInterval),c.currentValue=e,c.selectedIndex=-1,d.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(f),-1!==b)?void c.select(b):void(f.length<d.minChars?c.hide():c.getSuggestions(f))},findSuggestionIndex:function(b){var c=this,d=-1,e=b.toLowerCase();return a.each(c.suggestions,function(a,b){return b.value.toLowerCase()===e?(d=a,!1):void 0}),d},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},getSuggestionsLocal:function(b){var c,d=this,e=d.options,f=b.toLowerCase(),g=e.lookupFilter,h=parseInt(e.lookupLimit,10);return c={suggestions:a.grep(e.lookup,function(a){return g(a,b,f)})},h&&c.suggestions.length>h&&(c.suggestions=c.suggestions.slice(0,h)),c},getSuggestions:function(b){var d,e,f=this,g=f.options,h=g.serviceUrl,i=null;if(g.ignoreParams||(i=a.extend({},g.params),i[g.paramName]=b,a.isNumeric(g.count)&&g.count>0&&(i.count=g.count)),f.isLocal?d=f.getSuggestionsLocal(b):(a.isFunction(h)&&(h=h.call(f.element,b)),e=h+"?"+a.param(i||{}),d=f.cachedResponse[e]),d&&a.isArray(d.suggestions))f.suggestions=d.suggestions,f.suggest();else if(!f.isBadQuery(b)){if(g.onSearchStart.call(f.element,i)===!1)return;f.currentRequest&&f.currentRequest.abort(),f.showPreloader(),f.currentRequest=a.ajax(a.extend(f.getAjaxParams(),{url:h,data:c.serialize(i)})).done(function(a){var c;f.currentRequest=null,c=g.transformResult(a),f.enrichService.enrichResponse.call(f,c,b).done(function(a){f.processResponse(a,b,e),g.onSearchComplete.call(f.element,b,a.suggestions),f.hidePreloader()})}).fail(function(a,c,d){g.onSearchError.call(f.element,b,a,c,d),f.hidePreloader()})}},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,a.$container.hide().empty(),a.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var b,c=this,d=c.options,e=d.formatResult,f=c.getQuery(c.currentValue),g=c.classes.suggestion,h=c.classes.selected,i=d.beforeRender,j=c.$container,k=[];return d.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(f),-1!==b)?void c.select(b):(d.triggerSelectOnSpace&&!c.triggeredSelectOnSpace&&/\s$/.test(f)&&(b=c.findSuggestionIndex(f.replace(/\s$/,"")),-1!==b&&c.onSelect(b)),d.hint&&c.suggestions.length&&k.push('<div class="'+c.classes.hint+'">'+d.hint+"</div>"),a.each(c.suggestions,function(a,b){k.push('<div class="'+g+'" data-index="'+a+'">'+e(b,f)+"</div>")}),j.html(k.join("")),d.autoSelectFirst&&(c.selectedIndex=0,j.children().first().addClass(h)),a.isFunction(i)&&i.call(c.element,j),j.show(),c.visible=!0,void c.findBestHint())},showPreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).delay(50).animate({opacity:1},"fast")},hidePreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).animate({opacity:0},"fast")},findBestHint:function(){var b=this,c=b.el.val().toLowerCase(),d=null;c&&(a.each(b.suggestions,function(a,b){var e=0===b.value.toLowerCase().indexOf(c);return e&&(d=b),!e}),b.signalHint(d))},signalHint:function(b){var c="",d=this;b&&(c=d.currentValue+b.value.substr(d.currentValue.length)),d.hintValue!==c&&(d.hintValue=c,d.hint=b,(this.options.onHint||a.noop)(c))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&0===a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(b){var c,d,e=this,f=e.classes.selected;return!e.dropdownDisabled&&(d=e.$container.children("."+e.classes.suggestion),d.filter("."+f).removeClass(f),e.selectedIndex=b,-1!==e.selectedIndex&&d.length>e.selectedIndex)?(c=d.get(e.selectedIndex),a(c).addClass(f),c):null},enableDropdown:function(){var a=this;a.dropdownDisabled=!1,a.$container.attr("disabled",!1)},disableDropdown:function(){var a=this;a.dropdownDisabled=!0,a.$container.attr("disabled",!0)},selectHint:function(){var b=this,c=a.inArray(b.hint,b.suggestions);b.select(c)},selectCurrentValue:function(a){var b=this,c=b.selectedIndex;if(-1===c){var d=b.getQuery(b.el.val());c=b.findSuggestionIndex(d)}return-1!==c&&b.select(c,a),c},select:function(a,b){var c=this,d=c.suggestions[a],e=c.hasExpectedComponents(d)||c.triggeringSelectOnSpace?"":" ";c.currentValue=c.getValue(d.value),c.el.val(c.currentValue+e),c.signalHint(null),c.selection=d,c.onSelect(a).done(function(){b||c.hide()}),c.suggestions=[]},unselect:function(){var a=this;a.$container.children().removeClass(a.classes.selected),a.selectedIndex=-1,a.el.val(a.currentValue),a.findBestHint()},hasExpectedComponents:function(b){var c=this,d=!0;return a.each(c.expectedComponents,function(a,c){return d=d&&!!b.data[c]}),d},moveUp:function(){var a=this;if(!a.dropdownDisabled)return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.unselect():void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(!a.dropdownDisabled)return a.selectedIndex===a.suggestions.length-1?void a.unselect():void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=25;f&&(b=f.offsetTop,c=e.$container.scrollTop(),d=c+e.options.maxHeight-g,c>b?e.$container.scrollTop(b):b>d&&e.$container.scrollTop(b-e.options.maxHeight+g),e.el.val(e.getValue(e.suggestions[a].value)),e.signalHint(null))},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b],f=a.Deferred();return a.isFunction(d)?c.enrichService.enrichSuggestion.call(c,e).done(function(a){d.call(c.element,a),f.resolve()}):f.resolve(),f},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var a=this;a.el.off(f).removeData(g),a.$viewport.off("resize"+f),a.$wrapper.remove()},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)}},a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(g):this.each(function(){var e=a(this),f=e.data(g);"string"==typeof c?f&&"function"==typeof f[c]&&f[c](d):(f&&f.dispose&&f.dispose(),f=new b(this,c),e.data(g,f))})}});